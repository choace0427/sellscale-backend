<script>
    (function() {
      function sendTrackingData(ip, page) {
        var data = JSON.stringify({ ip: ip, page: page, track_key: {TRACK_KEY_HERE} });
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "https://api.sellscale.com/track/webpage", true);
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.send(data);
      }

      function trackPageView() {
        fetch('https://api.ipify.org/?format=json')
          .then(response => response.json())
          .then(data => {
          sendTrackingData(data.ip, window.location.href);
        })
          .catch(error => console.error('Error fetching IP:', error));
      }

      // Track the initial page view
      trackPageView();

      // Listen for popstate event (triggered by navigation changes)
      window.onpopstate = function(event) {
        trackPageView();
      };

      // For single-page applications: observe changes in the body element
      var observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
          if (mutation.type === "childList") {
            trackPageView();
          }
        });
      });

      // Start observing the target node for configured mutations
      observer.observe(document.body, {
        childList: true, // observes direct children
        subtree: true   // observes descendants
      });
    })();
  </script>